"use strict";(()=>{var e={};e.id=109,e.ids=[109],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},7803:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>E,patchFetch:()=>I,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>k});var a={};r.r(a),r.d(a,{GET:()=>h,POST:()=>D});var o=r(5419),s=r(9108),n=r(9678),i=r(8070),u=r(3334);let l=process.env.OF_API_KEY||"ofapi_bT4J1Er2YBow46EihDfjlSFf5HRmiM15M4DCOoHn7889d8b4",c="https://app.onlyfansapi.com/api",d=["my friend from college {username} just launched her OF \uD83E\uDD2D\uD83D\uDC95","OMG i cant believe my bestie just launched her OF \uD83D\uDE0D {username}","Your sign to follow my college bestie, you're welcome \uD83E\uDD2D {username} âœ¨","ok but have you seen {username} yet?? \uD83D\uDE0D\uD83D\uDD25","bestie alert \uD83D\uDEA8 go follow {username} rn","trust me on this one \uD83D\uDC40 {username}","she's literally so pretty go follow {username} \uD83D\uDC95","my girl {username} just started posting \uD83D\uDE48\uD83D\uDC97"];async function p(e){var t;let r=(t=e.targetUsername,d[Math.floor(Math.random()*d.length)].replace(/{username}/g,`@${t}`));try{let t=await fetch(`${c}/${e.promoterId}/posts`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({text:r,mediaFiles:[e.vaultId]})});if(!t.ok){let e=await t.text();return{success:!1,error:e}}let a=await t.json(),o=a.id||a.post_id||a.postId||a.data?.id;return{success:!0,postId:o}}catch(e){return{success:!1,error:String(e)}}}async function m(e){try{return(await fetch(`${c}/${e.accountId}/posts/${e.postId}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok}catch{return!1}}async function h(e){let t=e.headers.get("authorization"),r=process.env.CRON_SECRET;r&&t!==`Bearer ${r}`&&console.log("Cron called without valid secret");try{if(!await u.kv.get("rotation_active"))return i.Z.json({status:"paused",message:"Rotation is not active"});let e=Date.now(),t=await u.kv.get("schedule")||[],r=await u.kv.get("pending_deletions")||[],a=t.filter(t=>!t.executed&&t.timestamp<=e&&t.timestamp>e-12e4),o=[];for(let t of a){let a=await p(t);o.push({promoter:t.promoterUsername,target:t.targetUsername,...a}),a.success&&a.postId&&(t.executed=!0,t.postId=a.postId,t.deleteAt=e+3e5,r.push({postId:a.postId,accountId:t.promoterId,deleteAt:t.deleteAt,promoterUsername:t.promoterUsername,targetUsername:t.targetUsername}))}let s=r.filter(t=>t.deleteAt<=e),n=r.filter(t=>t.deleteAt>e),l=[];for(let e of s){let t=await m(e);l.push({postId:e.postId,promoter:e.promoterUsername,target:e.targetUsername,deleted:t})}await u.kv.set("schedule",t),await u.kv.set("pending_deletions",n),await u.kv.set("last_tick",new Date().toISOString());let c={timestamp:new Date().toISOString(),tagsExecuted:o.filter(e=>e.success).length,tagsFailed:o.filter(e=>!e.success).length,postsDeleted:l.filter(e=>e.deleted).length,pendingDeletions:n.length,totalRemaining:t.filter(e=>!e.executed).length},d=await u.kv.get("recent_activity")||[];return d.unshift({...c,results:o,deleteResults:l}),await u.kv.set("recent_activity",d.slice(0,100)),i.Z.json({status:"ok",...c,executed:o,deleted:l})}catch(e){return console.error("Cron tick error:",e),i.Z.json({status:"error",error:String(e)},{status:500})}}async function D(){return h(new Request("http://localhost"))}let g=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/cron/tick/route",pathname:"/api/cron/tick",filename:"route",bundlePath:"app/api/cron/tick/route"},resolvedPagePath:"/Users/moltplush/.openclaw/workspace/s4s-app/app/api/cron/tick/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:v,headerHooks:y,staticGenerationBailout:k}=g,E="/api/cron/tick/route";function I(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,334],()=>r(7803));module.exports=a})();