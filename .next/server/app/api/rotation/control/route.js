"use strict";(()=>{var t={};t.id=918,t.ids=[918],t.modules={517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:t=>{t.exports=require("node:crypto")},3407:(t,e,a)=>{a.r(e),a.d(e,{headerHooks:()=>h,originalPathname:()=>w,patchFetch:()=>_,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>k});var r={};a.r(r),a.d(r,{GET:()=>u,POST:()=>l});var o=a(5419),n=a(9108),i=a(9678),s=a(8070),c=a(3334);async function u(){try{let t=await c.kv.get("rotation_active")||!1,e=await c.kv.get("last_tick"),a=await c.kv.get("schedule_generated_at"),r=await c.kv.get("pending_deletions")||[],o=await c.kv.get("schedule")||[],n=await c.kv.get("recent_activity")||[],i=o.filter(t=>t.executed).length,u=o.filter(t=>!t.executed).length;return s.Z.json({active:t,lastTick:e,scheduleGeneratedAt:a,totalSlots:o.length,executed:i,remaining:u,pendingDeletions:r.length,recentActivity:n.slice(0,10)})}catch(t){return s.Z.json({error:"Failed to get status",details:String(t)},{status:500})}}async function l(t){try{let{action:e}=await t.json();if("start"===e){let t=await c.kv.get("schedule")||[];if(0===t.length)return s.Z.json({error:"No schedule found. Generate a schedule first."},{status:400});return await c.kv.set("rotation_active",!0),await c.kv.set("rotation_started_at",new Date().toISOString()),s.Z.json({success:!0,active:!0,message:"Rotation started! Make sure external cron is hitting /api/cron/tick every minute."})}if("stop"===e)return await c.kv.set("rotation_active",!1),await c.kv.set("rotation_stopped_at",new Date().toISOString()),s.Z.json({success:!0,active:!1,message:"Rotation stopped."});if("reset"===e)return await c.kv.set("rotation_active",!1),await c.kv.set("schedule",[]),await c.kv.set("pending_deletions",[]),await c.kv.set("recent_activity",[]),s.Z.json({success:!0,message:"Schedule and state reset. Generate a new schedule to continue."});return s.Z.json({error:"Invalid action",validActions:["start","stop","reset"]},{status:400})}catch(t){return s.Z.json({error:"Failed to control rotation",details:String(t)},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/rotation/control/route",pathname:"/api/rotation/control",filename:"route",bundlePath:"app/api/rotation/control/route"},resolvedPagePath:"/Users/moltplush/.openclaw/workspace/s4s-app/app/api/rotation/control/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:v,serverHooks:g,headerHooks:h,staticGenerationBailout:k}=d,w="/api/rotation/control/route";function _(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:v})}}};var e=require("../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),r=e.X(0,[638,206,334],()=>a(3407));module.exports=r})();