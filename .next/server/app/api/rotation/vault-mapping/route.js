"use strict";(()=>{var e={};e.id=77,e.ids=[77],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},656:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>O,originalPathname:()=>I,patchFetch:()=>P,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>k,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>b});var a={};r.r(a),r.d(a,{GET:()=>v,POST:()=>f,PUT:()=>j});var n=r(5419),o=r(9108),s=r(9678),i=r(8070);let u=require("fs/promises");var l=r(1017),p=r.n(l);let c=p().join(process.cwd(),"data"),d=p().join(c,"vault-mappings.json");async function m(){try{let e=await (0,u.readFile)(d,"utf-8");return JSON.parse(e)}catch{return{}}}async function g(e){await (0,u.mkdir)(c,{recursive:!0}),await (0,u.writeFile)(d,JSON.stringify(e,null,2))}async function v(){let e=await m(),t=Object.keys(e),r=0;for(let a of t)for(let t of e[a]?.images||[])r+=Object.keys(t.vaultIds||{}).length;return i.Z.json({promoterCount:t.length,totalVaults:r,mappings:e})}async function f(e){try{let{promoterUsername:t,accountId:r,images:a}=await e.json();if(!t||!r||!a)return i.Z.json({error:"Missing required fields",required:["promoterUsername","accountId","images"]},{status:400});let n=await m();return n[t]={accountId:r,images:a.map(e=>({imageId:e.id,vaultIds:e.vaultIds||{}}))},await g(n),i.Z.json({success:!0,promoter:t,imageCount:a.length,message:"Vault mappings saved"})}catch(e){return console.error("Save vault mapping error:",e),i.Z.json({error:"Internal server error",details:String(e)},{status:500})}}async function j(e){try{let{mappings:t}=await e.json();if(!t||"object"!=typeof t)return i.Z.json({error:"Missing mappings object"},{status:400});await g(t);let r=Object.keys(t),a=0;for(let e of r)for(let r of t[e]?.images||[])a+=Object.keys(r.vaultIds||{}).length;return i.Z.json({success:!0,promoterCount:r.length,totalVaults:a,message:"All vault mappings synced"})}catch(e){return console.error("Bulk sync error:",e),i.Z.json({error:"Internal server error",details:String(e)},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/rotation/vault-mapping/route",pathname:"/api/rotation/vault-mapping",filename:"route",bundlePath:"app/api/rotation/vault-mapping/route"},resolvedPagePath:"/Users/moltplush/.openclaw/workspace/s4s-app/app/api/rotation/vault-mapping/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:w,serverHooks:k,headerHooks:O,staticGenerationBailout:b}=h,I="/api/rotation/vault-mapping/route";function P(){return(0,s.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:w})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206],()=>r(656));module.exports=a})();