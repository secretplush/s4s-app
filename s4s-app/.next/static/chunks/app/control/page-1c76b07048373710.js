(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[350],{8280:function(e,t,s){Promise.resolve().then(s.bind(s,171))},171:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var a=s(3827),l=s(4090),r=s(8792),n=s(6737),i=s(251);function c(){let[e,t]=(0,l.useState)(null),[s,c]=(0,l.useState)(!1),[d,o]=(0,l.useState)(!1),[x,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(null),[g,b]=(0,l.useState)(!0),p=(0,l.useCallback)(async()=>{try{let e=await fetch("/api/rotation/control"),s=await e.json();t(s)}catch(e){console.error("Failed to fetch status:",e)}finally{b(!1)}},[]);(0,l.useEffect)(()=>{p();let e=setInterval(p,1e4);return()=>clearInterval(e)},[p]);let y=async()=>{c(!0),u(null);try{let e={},t=[];for(let s of n.aT)for(let a of(t.push({id:s.id,username:s.username}),await (0,i.lL)(s.username)))if(a.isActive&&a.vaultIds)for(let[t,l]of Object.entries(a.vaultIds))e[t]||(e[t]={}),e[t][s.username]=l;let s=await fetch("/api/sync/vault-mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mappings:e,models:t})}),a=await s.json();a.success?u("✅ Synced ".concat(a.modelCount," models with ").concat(a.totalVaultIds," vault mappings")):u("❌ ".concat(a.error))}catch(e){u("❌ Error: ".concat(e))}finally{c(!1)}},v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:14;o(!0),h(null);try{let t=await fetch("/api/schedule/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({days:e})}),s=await t.json();s.success?(h("✅ Generated ".concat(s.totalSlots," tags over ").concat(s.days," days (~").concat(s.avgPerDay,"/day)")),p()):h("❌ ".concat(s.error))}catch(e){h("❌ Error: ".concat(e))}finally{o(!1)}},j=async e=>{try{let t=await fetch("/api/rotation/control",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})});await t.json(),p()}catch(e){console.error("Control error:",e)}},f=async()=>{try{let e=await fetch("/api/cron/tick"),t=await e.json();console.log("Manual tick result:",t),p()}catch(e){console.error("Tick error:",e)}};return g?(0,a.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-8 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}):(0,a.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(r.default,{href:"/",className:"text-purple-400 hover:text-purple-300 mb-2 inline-block",children:"← Back to Dashboard"}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-white",children:"\uD83C\uDF9B️ Rotation Control Panel"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Set it and forget it — runs autonomously"})]}),(0,a.jsx)("div",{className:"px-4 py-2 rounded-full text-lg font-bold ".concat((null==e?void 0:e.active)?"bg-green-600 text-white animate-pulse":"bg-gray-600 text-gray-300"),children:(null==e?void 0:e.active)?"\uD83D\uDFE2 RUNNING":"⏸️ PAUSED"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:(null==e?void 0:e.totalSlots)||0}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"Total Scheduled"})]}),(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-green-400",children:(null==e?void 0:e.executed)||0}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"Executed"})]}),(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-yellow-400",children:(null==e?void 0:e.remaining)||0}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"Remaining"})]}),(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-purple-400",children:(null==e?void 0:e.pendingDeletions)||0}),(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"Pending Deletes"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"\uD83D\uDCCB Setup Steps"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"1. Sync Vault Mappings"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Push your local vault IDs to the server"})]}),(0,a.jsx)("button",{onClick:y,disabled:s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium disabled:opacity-50",children:s?"⏳ Syncing...":"\uD83D\uDCE4 Sync Now"})]}),x&&(0,a.jsx)("div",{className:"p-3 rounded-lg text-sm ".concat(x.includes("✅")?"bg-green-900/30 text-green-400":"bg-red-900/30 text-red-400"),children:x})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"2. Generate 14-Day Schedule"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Create the rotation plan"})]}),(0,a.jsx)("button",{onClick:()=>v(14),disabled:d,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium disabled:opacity-50",children:d?"⏳ Generating...":"\uD83D\uDCC5 Generate"})]}),m&&(0,a.jsx)("div",{className:"p-3 rounded-lg text-sm ".concat(m.includes("✅")?"bg-green-900/30 text-green-400":"bg-red-900/30 text-red-400"),children:m}),(null==e?void 0:e.scheduleGeneratedAt)&&(0,a.jsxs)("div",{className:"text-gray-500 text-xs mt-1",children:["Last generated: ",new Date(e.scheduleGeneratedAt).toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"3. Start Rotation"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Begin autonomous posting"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(null==e?void 0:e.active)?(0,a.jsx)("button",{onClick:()=>j("stop"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium",children:"⏹️ Stop"}):(0,a.jsx)("button",{onClick:()=>j("start"),disabled:!(null==e?void 0:e.totalSlots),className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium disabled:opacity-50",children:"▶️ Start"}),(0,a.jsx)("button",{onClick:f,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium",title:"Manually trigger one tick",children:"\uD83D\uDD04 Manual Tick"})]})]}),(null==e?void 0:e.lastTick)&&(0,a.jsxs)("div",{className:"text-gray-500 text-xs",children:["Last tick: ",new Date(e.lastTick).toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-900/20 border border-yellow-700/50 rounded-xl p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-yellow-400 mb-2",children:"⚠️ External Cron Required"}),(0,a.jsx)("p",{className:"text-gray-300 mb-3",children:'For true "set and forget", set up a free cron service to ping this URL every minute:'}),(0,a.jsx)("code",{className:"block bg-black/50 p-3 rounded text-green-400 text-sm mb-3 break-all",children:"GET https://s4s-app.vercel.app/api/cron/tick"}),(0,a.jsxs)("p",{className:"text-gray-400 text-sm",children:["Recommended: ",(0,a.jsx)("a",{href:"https://cron-job.org",target:"_blank",className:"text-blue-400 hover:underline",children:"cron-job.org"})," (free) or ",(0,a.jsx)("a",{href:"https://easycron.com",target:"_blank",className:"text-blue-400 hover:underline",children:"EasyCron"})]})]}),(null==e?void 0:e.recentActivity)&&e.recentActivity.length>0&&(0,a.jsxs)("div",{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"\uD83D\uDCCA Recent Activity"}),(0,a.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:e.recentActivity.map((e,t)=>(0,a.jsx)("div",{className:"bg-gray-700/30 rounded-lg p-3 text-sm",children:(0,a.jsxs)("div",{className:"flex justify-between text-gray-400",children:[(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleString()}),(0,a.jsxs)("span",{children:["✅ ",e.tagsExecuted," tags | \uD83D\uDDD1️ ",e.postsDeleted," deleted"]})]})},t))})]}),(0,a.jsx)("div",{className:"mt-6 text-center",children:(0,a.jsx)("button",{onClick:()=>{confirm("Reset all schedule data? This cannot be undone.")&&j("reset")},className:"text-red-400 hover:text-red-300 text-sm",children:"\uD83D\uDDD1️ Reset All Schedule Data"})})]})})}}},function(e){e.O(0,[792,966,971,69,744],function(){return e(e.s=8280)}),_N_E=e.O()}]);