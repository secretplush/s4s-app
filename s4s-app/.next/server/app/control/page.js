(()=>{var e={};e.id=350,e.ids=[350],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8977:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>d,routeModule:()=>m,tree:()=>c});var r=s(482),a=s(9108),l=s(2563),n=s.n(l),i=s(8300),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let c=["",{children:["control",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,3248)),"/Users/moltplush/.openclaw/workspace/s4s-app/app/control/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,2917)),"/Users/moltplush/.openclaw/workspace/s4s-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/moltplush/.openclaw/workspace/s4s-app/app/control/page.tsx"],x="/control/page",u={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/control/page",pathname:"/control",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},2058:(e,t,s)=>{Promise.resolve().then(s.bind(s,4843))},4843:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(5344),a=s(3729),l=s(6506),n=s(1648),i=s(3258);function o(){let[e,t]=(0,a.useState)(null),[s,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1),[x,u]=(0,a.useState)(null),[m,p]=(0,a.useState)(null),[h,g]=(0,a.useState)(!0),b=(0,a.useCallback)(async()=>{try{let e=await fetch("/api/rotation/control"),s=await e.json();t(s)}catch(e){console.error("Failed to fetch status:",e)}finally{g(!1)}},[]);(0,a.useEffect)(()=>{b();let e=setInterval(b,1e4);return()=>clearInterval(e)},[b]);let y=async()=>{o(!0),u(null);try{let e={},t=[];for(let s of n.aT)for(let r of(t.push({id:s.id,username:s.username}),await (0,i.lL)(s.username)))if(r.isActive&&r.vaultIds)for(let[t,a]of Object.entries(r.vaultIds))e[t]||(e[t]={}),e[t][s.username]=a;let s=await fetch("/api/sync/vault-mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mappings:e,models:t})}),r=await s.json();r.success?u(`✅ Synced ${r.modelCount} models with ${r.totalVaultIds} vault mappings`):u(`❌ ${r.error}`)}catch(e){u(`❌ Error: ${e}`)}finally{o(!1)}},j=async(e=14)=>{d(!0),p(null);try{let t=await fetch("/api/schedule/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({days:e})}),s=await t.json();s.success?(p(`✅ Generated ${s.totalSlots} tags over ${s.days} days (~${s.avgPerDay}/day)`),b()):p(`❌ ${s.error}`)}catch(e){p(`❌ Error: ${e}`)}finally{d(!1)}},v=async e=>{try{let t=await fetch("/api/rotation/control",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})});await t.json(),b()}catch(e){console.error("Control error:",e)}},f=async()=>{try{let e=await fetch("/api/cron/tick"),t=await e.json();console.log("Manual tick result:",t),b()}catch(e){console.error("Tick error:",e)}};return h?r.jsx("main",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-8 flex items-center justify-center",children:r.jsx("div",{className:"text-white text-xl",children:"Loading..."})}):r.jsx("main",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 p-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("div",{children:[r.jsx(l.default,{href:"/",className:"text-purple-400 hover:text-purple-300 mb-2 inline-block",children:"← Back to Dashboard"}),r.jsx("h1",{className:"text-3xl font-bold text-white",children:"\uD83C\uDF9B️ Rotation Control Panel"}),r.jsx("p",{className:"text-gray-400",children:"Set it and forget it — runs autonomously"})]}),r.jsx("div",{className:`px-4 py-2 rounded-full text-lg font-bold ${e?.active?"bg-green-600 text-white animate-pulse":"bg-gray-600 text-gray-300"}`,children:e?.active?"\uD83D\uDFE2 RUNNING":"⏸️ PAUSED"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[r.jsx("div",{className:"text-2xl font-bold text-white",children:e?.totalSlots||0}),r.jsx("div",{className:"text-gray-400 text-sm",children:"Total Scheduled"})]}),(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[r.jsx("div",{className:"text-2xl font-bold text-green-400",children:e?.executed||0}),r.jsx("div",{className:"text-gray-400 text-sm",children:"Executed"})]}),(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[r.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:e?.remaining||0}),r.jsx("div",{className:"text-gray-400 text-sm",children:"Remaining"})]}),(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-400",children:e?.pendingDeletions||0}),r.jsx("div",{className:"text-gray-400 text-sm",children:"Pending Deletes"})]})]}),(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700 mb-6",children:[r.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"\uD83D\uDCCB Setup Steps"}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"1. Sync Vault Mappings"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Push your local vault IDs to the server"})]}),r.jsx("button",{onClick:y,disabled:s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium disabled:opacity-50",children:s?"⏳ Syncing...":"\uD83D\uDCE4 Sync Now"})]}),x&&r.jsx("div",{className:`p-3 rounded-lg text-sm ${x.includes("✅")?"bg-green-900/30 text-green-400":"bg-red-900/30 text-red-400"}`,children:x})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"2. Generate 14-Day Schedule"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Create the rotation plan"})]}),r.jsx("button",{onClick:()=>j(14),disabled:c,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium disabled:opacity-50",children:c?"⏳ Generating...":"\uD83D\uDCC5 Generate"})]}),m&&r.jsx("div",{className:`p-3 rounded-lg text-sm ${m.includes("✅")?"bg-green-900/30 text-green-400":"bg-red-900/30 text-red-400"}`,children:m}),e?.scheduleGeneratedAt&&(0,r.jsxs)("div",{className:"text-gray-500 text-xs mt-1",children:["Last generated: ",new Date(e.scheduleGeneratedAt).toLocaleString()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-white",children:"3. Start Rotation"}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Begin autonomous posting"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[e?.active?r.jsx("button",{onClick:()=>v("stop"),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium",children:"⏹️ Stop"}):r.jsx("button",{onClick:()=>v("start"),disabled:!e?.totalSlots,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium disabled:opacity-50",children:"▶️ Start"}),r.jsx("button",{onClick:f,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium",title:"Manually trigger one tick",children:"\uD83D\uDD04 Manual Tick"})]})]}),e?.lastTick&&(0,r.jsxs)("div",{className:"text-gray-500 text-xs",children:["Last tick: ",new Date(e.lastTick).toLocaleString()]})]})]}),(0,r.jsxs)("div",{className:"bg-yellow-900/20 border border-yellow-700/50 rounded-xl p-6 mb-6",children:[r.jsx("h3",{className:"text-lg font-bold text-yellow-400 mb-2",children:"⚠️ External Cron Required"}),r.jsx("p",{className:"text-gray-300 mb-3",children:'For true "set and forget", set up a free cron service to ping this URL every minute:'}),r.jsx("code",{className:"block bg-black/50 p-3 rounded text-green-400 text-sm mb-3 break-all",children:"GET https://s4s-app.vercel.app/api/cron/tick"}),(0,r.jsxs)("p",{className:"text-gray-400 text-sm",children:["Recommended: ",r.jsx("a",{href:"https://cron-job.org",target:"_blank",className:"text-blue-400 hover:underline",children:"cron-job.org"})," (free) or ",r.jsx("a",{href:"https://easycron.com",target:"_blank",className:"text-blue-400 hover:underline",children:"EasyCron"})]})]}),e?.recentActivity&&e.recentActivity.length>0&&(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-xl p-6 border border-gray-700",children:[r.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"\uD83D\uDCCA Recent Activity"}),r.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:e.recentActivity.map((e,t)=>r.jsx("div",{className:"bg-gray-700/30 rounded-lg p-3 text-sm",children:(0,r.jsxs)("div",{className:"flex justify-between text-gray-400",children:[r.jsx("span",{children:new Date(e.timestamp).toLocaleString()}),(0,r.jsxs)("span",{children:["✅ ",e.tagsExecuted," tags | \uD83D\uDDD1️ ",e.postsDeleted," deleted"]})]})},t))})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsx("button",{onClick:()=>{confirm("Reset all schedule data? This cannot be undone.")&&v("reset")},className:"text-red-400 hover:text-red-300 text-sm",children:"\uD83D\uDDD1️ Reset All Schedule Data"})})]})})}},3248:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>l,__esModule:()=>a,default:()=>n});let r=(0,s(6843).createProxy)(String.raw`/Users/moltplush/.openclaw/workspace/s4s-app/app/control/page.tsx`),{__esModule:a,$$typeof:l}=r,n=r.default}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,356,506,849],()=>s(8977));module.exports=r})();