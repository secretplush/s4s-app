"use strict";(()=>{var e={};e.id=702,e.ids=[702],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7355:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>h,originalPathname:()=>g,patchFetch:()=>j,requestAsyncStorage:()=>c,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{POST:()=>d});var o=a(5419),i=a(9108),s=a(9678),n=a(8070);let p=process.env.OF_API_KEY||"ofapi_bT4J1Er2YBow46EihDfjlSFf5HRmiM15M4DCOoHn7889d8b4",u="https://app.onlyfansapi.com/api";async function d(e){try{let{account:t,imageBase64:a,filename:r,caption:o}=await e.json();if(!t||!a||!o)return n.Z.json({error:"Missing required fields",required:["account","imageBase64","caption"]},{status:400});let{buffer:i,mimeType:s}=function(e){let t=e.match(/^data:(.+);base64,(.+)$/);return t?{buffer:Buffer.from(t[2],"base64"),mimeType:t[1]}:{buffer:Buffer.from(e,"base64"),mimeType:"image/jpeg"}}(a),d=new FormData,l=new Blob([i],{type:s});d.append("file",l,r||"promo.jpg");let c=await fetch(`${u}/${t}/media/upload`,{method:"POST",headers:{Authorization:`Bearer ${p}`},body:d});if(!c.ok){let e=await c.text();return n.Z.json({error:"Upload failed",details:e},{status:500})}let f=await c.json(),m=f.prefixed_id||f.id;if(!m)return n.Z.json({error:"No media ID returned",data:f},{status:500});await new Promise(e=>setTimeout(e,11e3));let h=await fetch(`${u}/${t}/posts`,{method:"POST",headers:{Authorization:`Bearer ${p}`,"Content-Type":"application/json"},body:JSON.stringify({text:o,mediaFiles:[m]})});if(!h.ok){let e=await h.text();return n.Z.json({error:"Post creation failed",details:e},{status:500})}let w=await h.json(),g=w.id||w.post_id,j=w.media?.[0]?.vault_id||w.vault_id;return n.Z.json({success:!0,postId:g,mediaId:m,vaultId:j,message:`Ghost tag created! Post ID: ${g}`})}catch(e){return console.error("Post with upload error:",e),n.Z.json({error:"Internal server error",details:String(e)},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/rotation/post-with-upload/route",pathname:"/api/rotation/post-with-upload",filename:"route",bundlePath:"app/api/rotation/post-with-upload/route"},resolvedPagePath:"/Users/moltplush/.openclaw/workspace/s4s-app/app/api/rotation/post-with-upload/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:c,staticGenerationAsyncStorage:f,serverHooks:m,headerHooks:h,staticGenerationBailout:w}=l,g="/api/rotation/post-with-upload/route";function j(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206],()=>a(7355));module.exports=r})();