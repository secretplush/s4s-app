"use strict";(()=>{var e={};e.id=553,e.ids=[553],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6005:e=>{e.exports=require("node:crypto")},9828:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>f,originalPathname:()=>w,patchFetch:()=>k,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>v});var r={};a.r(r),a.d(r,{GET:()=>c,POST:()=>d});var s=a(5419),n=a(9108),o=a(9678),l=a(8070),u=a(3334);let i={0:4,1:9,2:6,3:3,4:8,5:4,6:4,7:7,8:3,9:3,10:8,11:5,12:5,13:6,14:6,15:3,16:6,17:3,18:3,19:4,20:3,21:4,22:3,23:3};async function d(e){try{let{days:t=14}=await e.json(),a=await u.kv.get("models"),r=await u.kv.get("vault_mappings");if(!a||a.length<2)return l.Z.json({error:"Need at least 2 models synced. Run vault sync first."},{status:400});if(!r||0===Object.keys(r).length)return l.Z.json({error:"No vault mappings found. Run vault sync first."},{status:400});let s=[];for(let e=0;e<t;e++){let t=function(e,t,a){let r=t.length;if(r<2)return[];let s=[],n=new Date;n.setHours(0,0,0,0),n.setDate(n.getDate()+e);let o=r-1,l=o*Math.max(1,Math.floor(56/o)),u=Object.values(i).reduce((e,t)=>e+t,0),d=[];for(let e=0;e<24;e++){let t=Math.round(i[e]/u*l*r);for(let a=0;a<t;a++)d.push(e)}for(let e=d.length-1;e>0;e--){let t=Math.floor(Math.random()*(e+1));[d[e],d[t]]=[d[t],d[e]]}let c=0;for(let e=0;e<r;e++){let o=t[e],u=a[o.username]||{};for(let a=0;a<l&&c<d.length;a++){let l=(e+a%(r-1)+1)%r;if(l===e)continue;let i=t[l],g=u[i.username];if(!g)continue;let h=d[c++],p=Math.floor(60*Math.random()),m=n.getTime()+36e5*h+6e4*p;s.push({timestamp:m,promoterUsername:o.username,promoterId:o.id,targetUsername:i.username,targetId:i.id,vaultId:g,executed:!1})}}return s.sort((e,t)=>e.timestamp-t.timestamp)}(e,a,r);s.push(...t)}return await u.kv.set("schedule",s),await u.kv.set("schedule_generated_at",new Date().toISOString()),await u.kv.set("schedule_days",t),await u.kv.set("rotation_active",!1),l.Z.json({success:!0,totalSlots:s.length,days:t,avgPerDay:Math.round(s.length/t),startsAt:new Date(s[0]?.timestamp).toISOString(),endsAt:new Date(s[s.length-1]?.timestamp).toISOString(),message:`Generated ${s.length} ghost tags over ${t} days`})}catch(e){return console.error("Generate schedule error:",e),l.Z.json({error:"Failed to generate schedule",details:String(e)},{status:500})}}async function c(){try{let e=await u.kv.get("schedule")||[],t=await u.kv.get("schedule_generated_at"),a=await u.kv.get("schedule_days"),r=await u.kv.get("rotation_active"),s=Date.now(),n=e.filter(e=>!e.executed&&e.timestamp>s).slice(0,20),o=e.filter(e=>e.executed).length,i=e.filter(e=>!e.executed&&e.timestamp<=s).length;return l.Z.json({success:!0,totalSlots:e.length,executed:o,pending:i,remaining:e.length-o,generatedAt:t,days:a,active:r,upcoming:n.map(e=>({...e,scheduledFor:new Date(e.timestamp).toISOString()}))})}catch(e){return l.Z.json({error:"Failed to get schedule",details:String(e)},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/schedule/generate/route",pathname:"/api/schedule/generate",filename:"route",bundlePath:"app/api/schedule/generate/route"},resolvedPagePath:"/Users/moltplush/.openclaw/workspace/s4s-app/app/api/schedule/generate/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:f,staticGenerationBailout:v}=g,w="/api/schedule/generate/route";function k(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[638,206,334],()=>a(9828));module.exports=r})();